<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>🌮 Taco Truck Menu 🚚</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #e94e1b;
            --accent-2: #ff9900;
            --yellow: #ffcc33;
            --bg: #fff8f0;
            --card: #fff3e0;
            --text: #333;
            --muted: #666;
            --max-width: 1200px;
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: 'Poppins', system-ui, Arial, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.35;
        }

        /* HEADER / NAV */
        .top-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 10px;
            background: linear-gradient(0deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7));
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-link {
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--accent);
            font-weight: 600;
        }

        .nav-link.active {
            background: var(--accent);
            color: #fff
        }

        header .header-content {
            max-width: var(--max-width);
            margin: 18px auto;
            padding: 12px;
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
        }

        header .header-content img {
            width: 72px;
            height: 72px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid var(--yellow);
        }

        header .info {
            text-align: center
        }

        header h1 {
            margin: 0;
            color: var(--accent);
            font-size: 1.6rem
        }

        header .sub {
            color: var(--muted);
            font-size: 0.95rem;
            margin-top: 6px
        }

        /* SPECIALS RIBBON */
        #specialsRibbon {
            background: var(--accent);
            color: #fff;
            text-align: center;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 0.98rem;
        }

        #specialsRibbon .special-list {
            margin-left: 8px;
            font-weight: 600
        }

        #specialsRibbon a {
            color: #fff;
            text-decoration: underline;
            margin: 0 6px;
            cursor: pointer
        }

        /* MENU CONTAINER */
        #menu {
            max-width: var(--max-width);
            margin: 20px auto;
            padding: 0 16px 60px;
        }

        .menu-section {
            margin-top: 28px;
        }

        /* Category - mobile looks clickable */
        .menu-category {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 10px 6px;
            background: transparent;
            border-bottom: 3px solid var(--yellow);
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--accent);
            cursor: pointer;
            border-radius: 6px 6px 0 0;
        }

        .menu-category button {
            background: transparent;
            border: 0;
            font-weight: 700;
            color: var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
        }

        .menu-category .chev {
            transition: transform .25s ease
        }

        /* Items wrapper (collapsible on mobile) */
        .menu-items {
            overflow: hidden;
            transition: max-height .36s cubic-bezier(.2, .9, .2, 1), opacity .25s;
            max-height: 0;
            opacity: 0;
            margin-bottom: 8px;
        }

        .menu-items.show {
            opacity: 1
        }

        /* Menu item - mobile default (side image + details) */
        .menu-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            margin: 12px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .menu-image {
            width: 112px;
            height: 112px;
            flex-shrink: 0;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--yellow);
            background: linear-gradient(180deg, #fff, #f6f0e8);
        }

        .menu-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block
        }

        .menu-card {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0;
            flex: 1;
        }

        .menu-top {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            align-items: flex-start;
        }

        .menu-title {
            font-weight: 700;
            color: var(--accent);
            font-size: 1.05rem
        }

        .menu-desc {
            color: var(--muted);
            font-size: 0.95rem;
            margin-top: 6px;
            white-space: normal
        }

        .price {
            color: var(--accent-2);
            font-weight: 800;
            margin-left: 6px;
            white-space: nowrap;
        }

        /* --- Mobile refinements --- */
        @media (max-width: 768px) {
            .menu-item {
                padding: 14px;
                /* more breathing room */
                gap: 14px;
                /* space between image and text */
            }

            .menu-image {
                width: 128px;
                /* bigger image */
                height: 128px;
            }

            .menu-title {
                font-size: 1.15rem;
                /* slightly bigger text */
            }

            .menu-desc {
                font-size: 1rem;
                color: #555;
            }

            .price {
                font-size: 1.15rem;
            }

            #specialsRibbon {
                font-size: 1.05rem;
                padding: 10px 14px;
            }

            /* Collapsed sections look better */
            .menu-section {
                margin: 22px 0;
                border-radius: 10px;
                background: #fff;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
                overflow: hidden;
            }

            .menu-category {
                padding: 14px 10px;
                background: linear-gradient(90deg, var(--yellow), var(--accent-2));
                color: #fff;
                border-radius: 10px 10px 0 0;
            }

            .menu-items {
                margin-bottom: 12px;
                padding: 0 6px;
                background: #fffaf3;
            }
        }


        /* Desktop: cards grid, image on top, equal height */
        @media (min-width:992px) {
            .menu-category {
                font-size: 1.45rem;
                cursor: default;
                padding: 8px 6px
            }

            .menu-items {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                max-height: unset !important;
                opacity: 1 !important;
            }

            .menu-item {
                flex-direction: column;
                padding: 0;
                overflow: hidden;
                height: 100%;
                border-radius: 14px;
                background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(255, 248, 240, 0.95));
                transition: transform .18s ease, box-shadow .18s ease;
            }

            .menu-item:hover {
                transform: translateY(-6px);
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12)
            }

            .menu-image {
                width: 100%;
                height: 180px;
                border-radius: 0;
                border: 0;
                overflow: hidden;
            }

            .menu-image img {
                border-radius: 0;
                height: 100%
            }

            .menu-card {
                padding: 14px;
            }

            .menu-top {
                align-items: center
            }

            .menu-title {
                font-size: 1.12rem
            }

            .menu-desc {
                margin-top: 10px;
                color: var(--muted);
                font-size: 0.96rem;
                min-height: 48px
            }

            .price {
                font-size: 1.05rem;
                margin-left: 0
            }
        }

        /* small helpers */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0
        }

        a.link-reset {
            color: inherit;
            text-decoration: none
        }

        /* responsive tidy */
        @media (max-width:520px) {
            .menu-image {
                width: 96px;
                height: 96px
            }

            header .header-content img {
                width: 56px;
                height: 56px
            }

            header h1 {
                font-size: 1.3rem
            }
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <a class="nav-link active" href="#">🌮 Food Truck Menu</a>
        <a class="nav-link" href="spa.html">🧖‍♀️ Spa Menu</a>
        <a class="nav-link" href="mechanic.html">🔧 Mechanic Menu</a>
    </nav>

    <header>
        <div class="header-content">
            <img src="https://s3.amazonaws.com/cdn.designcrowd.com/blog/45-Taco-Logos-for-Your-Taqueria/fast-mexican-taco-by-musiquedesign-brandcrowd.png"
                alt="logo">
            <div class="info">
                <h1>🌮 Taco Truck 🚚</h1>
                <div class="sub">123 Main Street · City, State · <a href="tel:+1234567890" class="link-reset">+1 (234)
                        567-890</a></div>
            </div>
        </div>
    </header>

    <div id="specialsRibbon" aria-live="polite" style="display:none"></div>

    <main id="menu" role="main" aria-label="Menu"></main>

    <!-- PapaParse (same as you used) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        // --- Configuration ---
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaKgZ1ycVG1w5xRnoAM0Gp8fAcrTltlUNiFLdnbJJ5MXAYRklU77P6IqDVD-nPXix2Q9cLJSyWufjb/pub?output=csv";
        const placeholderImage = "https://via.placeholder.com/400x300?text=Taco";
        const desktopBreakpoint = 992; // px

        let menuData = [];

        // --- Utility: normalize CSV row keys/values ---
        function normalizeRow(row) {
            const out = {};
            for (const k in row) {
                const key = (k || "").toLowerCase().trim();
                out[key] = (row[k] || "").trim();
            }
            return out;
        }

        // --- Load and parse CSV ---
        async function loadMenu() {
            try {
                const res = await fetch(CSV_URL);
                if (!res.ok) throw new Error("Failed to fetch CSV");
                const text = await res.text();
                const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
                menuData = parsed.data.map((r, i) => {
                    const n = normalizeRow(r);
                    return {
                        id: `item-${i}`,
                        category: n['category'] || "Uncategorized",
                        item: n['item'] || "Unnamed",
                        description: n['description'] || "",
                        price: n['price'] || "",
                        image: n['image'] || placeholderImage,
                        special: (n['special'] || "").toLowerCase(),
                        ribbon_text: n['ribbon_text'] || ""
                    };
                });
            } catch (err) {
                console.error("Load menu error:", err);
                // fallback sample if fetch fails
                menuData = [
                    { id: "item-fallback-1", category: "Tacos", item: "Carne Asada", description: "Grilled steak, onion, cilantro", price: "3.50", image: placeholderImage, special: "yes", ribbon_text: "Today's Specials" },
                    { id: "item-fallback-2", category: "Drinks", item: "Horchata", description: "Cinnamon rice drink", price: "2.50", image: placeholderImage, special: "", ribbon_text: "" }
                ];
            }
            renderSpecials(menuData);
            renderMenu(menuData);
        }

        // --- Specials ribbon ---
        function renderSpecials(data) {
            const ribbon = document.getElementById("specialsRibbon");
            const specials = data.filter(d => d.special === "yes" || d.special === "y" || d.special === "true");
            if (!specials.length) {
                ribbon.style.display = "none";
                return;
            }
            ribbon.style.display = "block";

            const text = specials[0].ribbon_text || "Today's Specials:";
            ribbon.innerHTML = '';

            const label = document.createElement('span');
            label.textContent = '🌟 ' + text;
            ribbon.appendChild(label);

            const list = document.createElement('span');
            list.className = "special-list";

            specials.forEach((s, idx) => {
                const a = document.createElement('a');
                a.href = `#${s.id}`;
                a.textContent = s.item;

                a.addEventListener('click', (ev) => {
                    ev.preventDefault();
                    const target = document.getElementById(s.id);
                    if (!target) return;

                    const parentItems = target.closest('.menu-items');

                    // Helper to scroll once ready
                    const scrollToTarget = () => {
                        requestAnimationFrame(() => {
                            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        });
                    };

                    if (parentItems && !parentItems.classList.contains('show')) {
                        // Expand section first
                        toggleSection(parentItems, true);

                        // Wait for the transition to finish (~360ms in CSS) before scrolling
                        setTimeout(scrollToTarget, 360);
                    } else {
                        scrollToTarget();
                    }
                });

                list.appendChild(a);
                if (idx < specials.length - 1) {
                    const sep = document.createTextNode(' · ');
                    list.appendChild(sep);
                }
            });

            ribbon.appendChild(list);
        }


        // --- Toggle helper for collapsing categories (mobile) ---
        function toggleSection(itemsDiv, expand) {
            if (expand === undefined) expand = !itemsDiv.classList.contains('show');
            if (expand) {
                itemsDiv.classList.add('show');
                requestAnimationFrame(() => {
                    itemsDiv.style.maxHeight = itemsDiv.scrollHeight + "px";
                });
            } else {
                itemsDiv.style.maxHeight = itemsDiv.scrollHeight + "px"; // start from current
                requestAnimationFrame(() => {
                    itemsDiv.classList.remove('show');
                    itemsDiv.style.maxHeight = null;
                });
            }
            // update aria-expanded on header
            const header = itemsDiv.previousElementSibling;
            if (header && header.querySelector('button')) {
                header.querySelector('button').setAttribute('aria-expanded', String(expand));
                const chev = header.querySelector('.chev');
                if (chev) chev.style.transform = expand ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        }


        // --- Main render ---
        function renderMenu(data) {
            const container = document.getElementById("menu");
            container.innerHTML = "";
            const grouped = {};
            data.forEach(it => {
                const cat = it.category || "Uncategorized";
                if (!grouped[cat]) grouped[cat] = [];
                grouped[cat].push(it);
            });

            const isDesktop = window.innerWidth >= desktopBreakpoint;

            // build each category section
            Object.keys(grouped).forEach(cat => {
                const section = document.createElement('section');
                section.className = 'menu-section';

                // category header (button for mobile toggle)
                const header = document.createElement('div');
                header.className = 'menu-category';
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.innerHTML = `<span>${cat}</span><span aria-hidden="true" class="chev">▾</span>`;
                btn.setAttribute('aria-expanded', String(isDesktop));
                header.appendChild(btn);
                section.appendChild(header);

                // items container
                const itemsDiv = document.createElement('div');
                itemsDiv.className = 'menu-items';
                if (isDesktop) {
                    itemsDiv.classList.add('show');
                    itemsDiv.style.maxHeight = null;
                } else {
                    // collapsed by default on mobile
                    itemsDiv.style.maxHeight = null;
                    itemsDiv.classList.remove('show');
                }

                // create cards
                grouped[cat].forEach(it => {
                    const card = document.createElement('article');
                    card.className = 'menu-item';
                    card.id = it.id;

                    // inner markup: image + card body
                    card.innerHTML = `
            <div class="menu-image" aria-hidden="true">
              <img loading="lazy" src="${escapeHtml(it.image || placeholderImage)}" alt="${escapeHtml(it.item)}">
            </div>
            <div class="menu-card">
              <div class="menu-top">
                <div class="menu-title">${escapeHtml(it.item)}</div>
                <div class="price">${it.price ? '$' + escapeHtml(it.price) : ''}</div>
              </div>
              <div class="menu-desc">${escapeHtml(it.description)}</div>
            </div>
          `;
                    // image click fullscreen
                    const img = card.querySelector('.menu-image img');
                    img.addEventListener('click', () => openImageFullScreen(img.src));
                    itemsDiv.appendChild(card);
                });

                section.appendChild(itemsDiv);
                container.appendChild(section);

                // event: toggle on mobile only
                btn.addEventListener('click', () => {
                    if (window.innerWidth >= desktopBreakpoint) return; // no toggling on desktop
                    toggleSection(itemsDiv);
                });

                // on desktop, disable pointer cursor for header button
                if (isDesktop) {
                    btn.style.cursor = 'default';
                    btn.querySelector('.chev').style.display = 'none';
                } else {
                    btn.style.cursor = 'pointer';
                    btn.querySelector('.chev').style.display = 'inline-block';
                }
            });
        }

        // --- open image overlay ---
        function openImageFullScreen(url) {
            const existing = document.querySelector('.image-overlay');
            if (existing) existing.remove();

            const overlay = document.createElement('div');
            overlay.className = 'image-overlay';
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.background = 'rgba(0,0,0,0.82)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = 99999;
            overlay.style.cursor = 'zoom-out';

            const img = document.createElement('img');
            img.src = url;
            img.alt = '';
            img.style.maxWidth = '92%';
            img.style.maxHeight = '92%';
            img.style.borderRadius = '10px';
            overlay.appendChild(img);

            overlay.addEventListener('click', () => overlay.remove());
            document.body.appendChild(overlay);
        }


        // --- small HTML escape to avoid injecting raw CSV markup into DOM ---
        function escapeHtml(str) {
            if (str === null || str === undefined) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }


        // --- responsive: re-render on resize (debounced) ---
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                renderMenu(menuData);
            }, 180);
        });

        // initial load
        loadMenu();
    </script>
</body>

</html>